<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CGBVP | Sistema de Entrenamiento Táctico v4.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;600&family=Roboto+Mono:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        /* --- CORE VARIABLES --- */
        :root {
            --bg-dark: #0f172a;
            --bg-panel: rgba(30, 41, 59, 0.75);
            --primary-red: #ef4444;
            --accent-red: #b91c1c;
            --highlight-yellow: #facc15;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --success: #10b981;
            
            /* Colores de Módulos */
            --mod1-color: #3b82f6; /* Azul */
            --mod2-color: #10b981; /* Verde */
            --mod3-color: #f97316; /* Naranja */

            --border-color: rgba(255, 255, 255, 0.1);
            --blur: 16px;
            --transition: cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* --- GLOBAL STYLES --- */
        body {
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(at 0% 0%, rgba(239, 68, 68, 0.1) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(15, 23, 42, 1) 0px, transparent 50%),
                repeating-linear-gradient(45deg, rgba(0,0,0,0.02) 0px, rgba(0,0,0,0.02) 2px, transparent 2px, transparent 4px);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        * { box-sizing: border-box; outline: none; user-select: none; }

        /* --- UI COMPONENTS --- */
        .glass-panel {
            background: var(--bg-panel);
            backdrop-filter: blur(var(--blur));
            -webkit-backdrop-filter: blur(var(--blur));
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }

        /* --- HEADER --- */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px 25px;
            animation: slideDown 0.6s var(--transition);
        }

        .brand { display: flex; align-items: center; gap: 15px; }
        .brand-text h1 {
            font-family: 'Oswald', sans-serif; font-size: 1.6rem; margin: 0; letter-spacing: 2px;
            text-transform: uppercase;
            background: linear-gradient(90deg, #fff, #bbb); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .status-dot {
            width: 10px; height: 10px; background: var(--primary-red); border-radius: 50%;
            box-shadow: 0 0 10px var(--primary-red); animation: pulse 2s infinite;
        }

        /* --- BUTTONS --- */
        .btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-color);
            color: var(--text-main);
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Oswald', sans-serif;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: all 0.2s;
            display: inline-flex; align-items: center; gap: 8px; font-size: 0.9rem;
        }
        .btn:hover { background: rgba(255,255,255,0.1); border-color: var(--text-muted); transform: translateY(-2px); }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-red), var(--primary-red)); border: none;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        .btn-primary:hover { box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5); }
        .btn-icon { padding: 8px; border-radius: 50%; }

        /* --- VIEWS --- */
        .view { display: none; opacity: 0; transform: translateY(10px); transition: all 0.4s var(--transition); }
        .view.active { display: block; opacity: 1; transform: translateY(0); }
        .container { max-width: 1000px; margin: 0 auto; }

        /* --- DASHBOARD --- */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { padding: 15px; border-left: 3px solid var(--primary-red); }
        .stat-val { font-family: 'Roboto Mono'; font-size: 1.8rem; font-weight: 700; display: block; }
        .stat-lbl { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }

        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        
        .flashcard-item {
            padding: 20px; position: relative; overflow: hidden;
            border-top: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s;
        }
        .flashcard-item:hover { transform: translateY(-4px); border-color: var(--primary-red); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }

        /* Badges de Módulo */
        .mod-badge {
            font-family: 'Roboto Mono'; font-size: 0.65rem; padding: 3px 8px; border-radius: 4px;
            text-transform: uppercase; font-weight: bold; letter-spacing: 0.5px;
            display: inline-block; margin-bottom: 10px;
        }
        .mod-m1 { background: rgba(59, 130, 246, 0.2); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.3); }
        .mod-m2 { background: rgba(16, 185, 129, 0.2); color: #34d399; border: 1px solid rgba(16, 185, 129, 0.3); }
        .mod-m3 { background: rgba(249, 115, 22, 0.2); color: #fb923c; border: 1px solid rgba(249, 115, 22, 0.3); }

        /* --- FORMULARIOS --- */
        label { display: block; margin-bottom: 8px; font-family: 'Oswald'; color: var(--text-muted); letter-spacing: 1px; font-size: 0.9rem; }
        input[type="text"], textarea, select {
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border-color);
            color: var(--text-main); padding: 12px; border-radius: 6px; font-family: 'Inter'; transition: 0.3s;
        }
        input:focus, textarea:focus, select:focus { border-color: var(--primary-red); background: rgba(0,0,0,0.5); }
        
        /* Select Táctico */
        select { appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 10px center; background-size: 20px; cursor: pointer; }

        .option-row { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; animation: slideInRight 0.3s forwards; }
        .custom-radio {
            appearance: none; width: 20px; height: 20px; border: 2px solid var(--text-muted); border-radius: 50%; cursor: pointer; flex-shrink: 0; position: relative;
        }
        .custom-radio:checked { border-color: var(--success); }
        .custom-radio:checked::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 10px; height: 10px; background: var(--success); border-radius: 50%; }

        /* --- MODAL DE SELECCIÓN DE MISIÓN --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
            z-index: 1000; display: none; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s;
        }
        .modal-overlay.open { display: flex; opacity: 1; }
        
        .mission-panel {
            background: #1e293b; border: 1px solid var(--border-color); border-radius: 16px;
            padding: 30px; width: 90%; max-width: 500px; text-align: center;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            transform: scale(0.9); transition: transform 0.3s;
        }
        .modal-overlay.open .mission-panel { transform: scale(1); }

        .mission-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .mission-btn {
            background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); padding: 20px;
            border-radius: 8px; cursor: pointer; transition: 0.2s; text-align: left;
        }
        .mission-btn:hover { background: rgba(255,255,255,0.1); transform: translateY(-2px); }
        .mission-btn h4 { margin: 0; font-family: 'Oswald'; font-size: 1.1rem; }
        .mission-btn span { font-size: 0.75rem; color: var(--text-muted); }
        
        /* Colores botones misión */
        .m-all { border-left: 4px solid var(--text-main); }
        .m-1 { border-left: 4px solid var(--mod1-color); }
        .m-2 { border-left: 4px solid var(--mod2-color); }
        .m-3 { border-left: 4px solid var(--mod3-color); }

        /* --- SIMULADOR --- */
        .sim-option {
            background: rgba(255,255,255,0.05); padding: 15px; margin-bottom: 10px; border-radius: 8px;
            cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 15px;
        }
        .sim-option:hover { background: rgba(255,255,255,0.1); transform: translateX(5px); }
        .sim-option.correct { background: rgba(16, 185, 129, 0.2); border: 1px solid var(--success); color: var(--success); }
        .sim-option.wrong { background: rgba(239, 68, 68, 0.2); border: 1px solid var(--primary-red); color: var(--primary-red); animation: shake 0.4s; }

        /* --- ANIMACIONES --- */
        @keyframes slideDown { from { transform: translateY(-30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideInRight { from { transform: translateX(-10px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-4px); } 75% { transform: translateX(4px); } }
        
        svg { width: 18px; height: 18px; fill: currentColor; }
    </style>
</head>
<body>

    <div class="container">
        <div class="top-bar glass-panel">
            <div class="brand">
                <div class="status-dot"></div>
                <div class="brand-text">
                    <h1>CGBVP <span>TACTICAL</span></h1>
                </div>
            </div>
            <nav style="display: flex; gap: 10px;">
                <button onclick="showList()" class="btn">
                    <svg viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H8V4h12v12z"/></svg> Base de Datos
                </button>
                <button onclick="showCreate()" class="btn">
                    <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg> Nuevo Registro
                </button>
                <button onclick="openMissionModal()" id="nav-play-btn" class="btn btn-primary" style="display:none;">
                    <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg> INICIAR SIMULACRO
                </button>
            </nav>
        </div>

        <div id="missionModal" class="modal-overlay" onclick="if(event.target === this) closeMissionModal()">
            <div class="mission-panel">
                <h2 style="font-family: 'Oswald'; margin-bottom: 5px;">CONFIGURACIÓN DE MISIÓN</h2>
                <p style="color: var(--text-muted); font-size: 0.9rem; margin-top: 0;">Seleccione el sector operativo a evaluar</p>
                
                <div class="mission-grid">
                    <div class="mission-btn m-1" onclick="launchSimulation('m1')">
                        <h4>MÓDULO 1</h4>
                        <span>Lucha Contra Incendios</span>
                    </div>
                    <div class="mission-btn m-2" onclick="launchSimulation('m2')">
                        <h4>MÓDULO 2</h4>
                        <span>Atención Pre-Hospitalaria</span>
                    </div>
                    <div class="mission-btn m-3" onclick="launchSimulation('m3')">
                        <h4>MÓDULO 3</h4>
                        <span>MATPEL / Rescate</span>
                    </div>
                    <div class="mission-btn m-all" onclick="launchSimulation('all')">
                        <h4>TODOS LOS SECTORES</h4>
                        <span>Evaluación General</span>
                    </div>
                </div>
                <button onclick="closeMissionModal()" class="btn" style="margin-top: 20px; width: 100%; justify-content: center;">CANCELAR</button>
            </div>
        </div>

        <div id="listView" class="view active">
            <div class="stats-grid">
                <div class="glass-panel stat-card" style="border-color: var(--mod1-color);">
                    <span class="stat-val" id="countM1">0</span>
                    <span class="stat-lbl">Módulo 1</span>
                </div>
                <div class="glass-panel stat-card" style="border-color: var(--mod2-color);">
                    <span class="stat-val" id="countM2">0</span>
                    <span class="stat-lbl">Módulo 2</span>
                </div>
                <div class="glass-panel stat-card" style="border-color: var(--mod3-color);">
                    <span class="stat-val" id="countM3">0</span>
                    <span class="stat-lbl">Módulo 3</span>
                </div>
            </div>

            <div id="cardsContainer" class="card-grid"></div>
            
            <div id="emptyState" style="text-align: center; padding: 50px; opacity: 0.5; display: none;">
                <h3>SISTEMA EN ESPERA</h3>
                <p>No hay datos cargados.</p>
            </div>
        </div>

        <div id="createView" class="view">
            <div class="glass-panel" style="padding: 30px; max-width: 700px; margin: 0 auto;">
                <h2 style="font-family: 'Oswald'; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; margin-top: 0;">INGRESO DE DATOS</h2>

                <div style="margin-bottom: 20px;">
                    <label>ASIGNACIÓN DE MÓDULO</label>
                    <select id="moduleSelect">
                        <option value="m1">MÓDULO 1: LUCHA CONTRA INCENDIOS</option>
                        <option value="m2">MÓDULO 2: PRIMEROS AUXILIOS</option>
                        <option value="m3">MÓDULO 3: MATPEL / RESCATE</option>
                    </select>
                </div>

                <div style="margin-bottom: 20px;">
                    <label>INTERROGANTE TÉCNICA</label>
                    <textarea id="questionInput" rows="3" placeholder="Escriba la pregunta aquí..."></textarea>
                </div>

                <div style="margin-bottom: 20px;">
                    <label>ALTERNATIVAS (MARCAR CORRECTA)</label>
                    <div id="optionsList"></div>
                    <button onclick="addOptionInput()" class="btn" style="width: 100%; justify-content: center; margin-top: 10px; border-style: dashed;">+ AGREGAR OPCIÓN</button>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button onclick="saveCard()" class="btn btn-primary" style="flex: 2;">GUARDAR REGISTRO</button>
                    <button onclick="showList()" class="btn" style="flex: 1; border-color: var(--primary-red); color: var(--primary-red);">CANCELAR</button>
                </div>
            </div>
        </div>

        <div id="studyView" class="view">
            <div class="glass-panel" style="padding: 40px; max-width: 800px; margin: 0 auto;">
                <div style="height: 4px; background: rgba(255,255,255,0.1); width: 100%; margin-bottom: 20px; border-radius: 2px;">
                    <div id="progressBar" style="height: 100%; background: var(--highlight-yellow); width: 0%; transition: width 0.3s;"></div>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 30px; font-family: 'Roboto Mono'; font-size: 0.8rem; color: var(--text-muted);">
                    <span id="simModuleBadge">MODULO ??</span>
                    <span id="progressText">0/0</span>
                </div>

                <div id="studyArea"></div>

                <div id="controlsArea" style="margin-top: 30px; display: flex; justify-content: space-between; opacity: 0; pointer-events: none; transition: opacity 0.3s;">
                    <button onclick="showList()" class="btn">FINALIZAR</button>
                    <button onclick="nextCard()" class="btn btn-primary">SIGUIENTE ></button>
                </div>
            </div>
        </div>
    </div>

<script>
    // --- ESTADO DEL SISTEMA ---
    const DB_KEY = 'cgbvp_tactical_v4';
    let database = JSON.parse(localStorage.getItem(DB_KEY)) || [];
    let session = { queue: [], index: 0 };
    let editModeId = null;

    // --- INICIALIZACIÓN ---
    updateDashboard();

    // --- NAVEGACIÓN ---
    function switchView(viewName) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        setTimeout(() => document.getElementById(viewName).classList.add('active'), 50);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showList() { switchView('listView'); updateDashboard(); editModeId = null; }
    function showCreate() { switchView('createView'); resetForm(); }

    // --- GESTIÓN DE MODALES ---
    function openMissionModal() { document.getElementById('missionModal').classList.add('open'); }
    function closeMissionModal() { document.getElementById('missionModal').classList.remove('open'); }

    // --- DASHBOARD LOGIC ---
    function updateDashboard() {
        const container = document.getElementById('cardsContainer');
        const emptyState = document.getElementById('emptyState');
        const playBtn = document.getElementById('nav-play-btn');

        // Contadores
        const counts = { m1: 0, m2: 0, m3: 0 };
        database.forEach(c => { if(counts[c.module] !== undefined) counts[c.module]++ });
        
        document.getElementById('countM1').innerText = counts.m1;
        document.getElementById('countM2').innerText = counts.m2;
        document.getElementById('countM3').innerText = counts.m3;

        container.innerHTML = '';

        if (database.length === 0) {
            emptyState.style.display = 'block';
            playBtn.style.display = 'none';
        } else {
            emptyState.style.display = 'none';
            playBtn.style.display = 'inline-flex';

            database.forEach((card, i) => {
                // Definir estilos según módulo
                let modLabel = "GENERAL";
                let modClass = "";
                if(card.module === 'm1') { modLabel = "MOD 1: INCENDIOS"; modClass = "mod-m1"; }
                if(card.module === 'm2') { modLabel = "MOD 2: MEDICOS"; modClass = "mod-m2"; }
                if(card.module === 'm3') { modLabel = "MOD 3: MATPEL"; modClass = "mod-m3"; }

                const el = document.createElement('div');
                el.className = 'glass-panel flashcard-item';
                el.style.animation = `slideDown 0.4s ease forwards ${i * 0.05}s`;
                el.style.opacity = '0';
                
                el.innerHTML = `
                    <span class="mod-badge ${modClass}">${modLabel}</span>
                    <h4 style="margin: 5px 0 15px 0; font-weight: 400; font-size: 1.1rem;">${card.question}</h4>
                    <div style="display: flex; justify-content: flex-end; gap: 5px; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 10px;">
                        <button onclick="editCard(${card.id})" class="btn btn-icon"><svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg></button>
                        <button onclick="deleteCard(${card.id})" class="btn btn-icon" style="color: var(--primary-red);"><svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg></button>
                    </div>
                `;
                container.appendChild(el);
            });
        }
    }

    // --- FORM LOGIC ---
    function addOptionInput(val = '', isCorrect = false) {
        const container = document.getElementById('optionsList');
        const div = document.createElement('div');
        div.className = 'option-row';
        div.innerHTML = `
            <input type="radio" name="correctAnswer" class="custom-radio" ${isCorrect ? 'checked' : ''}>
            <input type="text" class="opt-text" value="${val}" placeholder="Opción de respuesta...">
            <button onclick="this.parentElement.remove()" class="btn btn-icon" style="color: var(--primary-red);"><svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button>
        `;
        container.appendChild(div);
    }

    function resetForm() {
        document.getElementById('moduleSelect').value = 'm1';
        document.getElementById('questionInput').value = '';
        document.getElementById('optionsList').innerHTML = '';
        addOptionInput(); addOptionInput();
    }

    function saveCard() {
        const mod = document.getElementById('moduleSelect').value;
        const q = document.getElementById('questionInput').value.trim();
        const rows = document.querySelectorAll('.option-row');
        let options = [];
        let correctIndex = -1;

        rows.forEach((row, idx) => {
            const txt = row.querySelector('.opt-text').value.trim();
            if (txt) {
                options.push(txt);
                if (row.querySelector('input').checked) correctIndex = options.length - 1;
            }
        });

        if (!q || options.length < 2 || correctIndex === -1) {
            alert('COMANDO: DATOS INCOMPLETOS. REVISE FORMULARIO.');
            return;
        }

        const payload = { id: editModeId || Date.now(), module: mod, question: q, options, correctIndex };

        if (editModeId) {
            const idx = database.findIndex(x => x.id === editModeId);
            database[idx] = payload;
        } else {
            database.push(payload);
        }

        localStorage.setItem(DB_KEY, JSON.stringify(database));
        showList();
    }

    function editCard(id) {
        const card = database.find(c => c.id === id);
        if (!card) return;
        editModeId = id;
        switchView('createView');
        document.getElementById('moduleSelect').value = card.module || 'm1'; // Backward compatibility
        document.getElementById('questionInput').value = card.question;
        const list = document.getElementById('optionsList');
        list.innerHTML = '';
        card.options.forEach((opt, i) => addOptionInput(opt, i === card.correctIndex));
    }

    function deleteCard(id) {
        if(confirm('¿CONFIRMA ELIMINACIÓN TÁCTICA?')) {
            database = database.filter(c => c.id !== id);
            localStorage.setItem(DB_KEY, JSON.stringify(database));
            updateDashboard();
        }
    }

    // --- SIMULATION ENGINE ---
    function launchSimulation(filterType) {
        closeMissionModal();
        
        // Filtramos las tarjetas
        if (filterType === 'all') {
            session.queue = [...database];
        } else {
            session.queue = database.filter(c => c.module === filterType);
        }

        // Shuffle (Mezclar aleatoriamente las preguntas para realismo)
        session.queue.sort(() => Math.random() - 0.5);

        if (session.queue.length === 0) {
            alert("NO SE ENCONTRARON OBJETIVOS EN ESTE SECTOR.");
            return;
        }

        session.index = 0;
        
        // Actualizar UI del Header simulador
        const badge = document.getElementById('simModuleBadge');
        if(filterType === 'm1') { badge.innerText = "SECTOR: INCENDIOS"; badge.style.color = "var(--mod1-color)"; }
        else if(filterType === 'm2') { badge.innerText = "SECTOR: MEDICOS"; badge.style.color = "var(--mod2-color)"; }
        else if(filterType === 'm3') { badge.innerText = "SECTOR: MATPEL"; badge.style.color = "var(--mod3-color)"; }
        else { badge.innerText = "SECTOR: INTEGRAL"; badge.style.color = "white"; }

        switchView('studyView');
        renderSlide();
    }

    function renderSlide() {
        const card = session.queue[session.index];
        const area = document.getElementById('studyArea');
        const controls = document.getElementById('controlsArea');
        
        controls.style.opacity = '0';
        controls.style.pointerEvents = 'none';
        
        // Progress
        const pct = ((session.index + 1) / session.queue.length) * 100;
        document.getElementById('progressBar').style.width = `${pct}%`;
        document.getElementById('progressText').innerText = `${session.index + 1}/${session.queue.length}`;

        area.innerHTML = `
            <div style="font-size: 1.4rem; font-weight:600; text-align:center; margin-bottom: 30px; animation: slideDown 0.4s;">
                ${card.question}
            </div>
            <div id="simOptionsContainer"></div>
        `;

        const optCont = document.getElementById('simOptionsContainer');
        card.options.forEach((opt, i) => {
            const btn = document.createElement('div');
            btn.className = 'sim-option';
            btn.innerHTML = `<strong>${String.fromCharCode(65+i)}.</strong> &nbsp; ${opt}`;
            btn.style.animation = `slideInRight 0.3s forwards ${i*0.1}s`;
            btn.style.opacity = '0';
            btn.onclick = () => checkAnswer(btn, i, card.correctIndex);
            optCont.appendChild(btn);
        });
    }

    function checkAnswer(el, selectedIdx, correctIdx) {
        const allOpts = document.querySelectorAll('.sim-option');
        if (el.classList.contains('locked')) return; // Prevenir doble click
        
        allOpts.forEach(o => {
            o.classList.add('locked');
            o.style.cursor = 'default';
        });

        if (selectedIdx === correctIdx) {
            el.classList.add('correct');
        } else {
            el.classList.add('wrong');
            allOpts[correctIdx].classList.add('correct'); // Mostrar la verdadera
        }

        const controls = document.getElementById('controlsArea');
        controls.style.opacity = '1';
        controls.style.pointerEvents = 'all';
    }

    function nextCard() {
        if (session.index < session.queue.length - 1) {
            session.index++;
            renderSlide();
        } else {
            alert('MISIÓN CUMPLIDA. RETORNANDO A BASE.');
            showList();
        }
    }

</script>
</body>
</html>
